<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordBox 2 Joueurs</title>
    <style>
        /* COLLE TOUT TON CSS ICI */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { background: #1a202c; min-height: 100vh; padding: 20px; }
        .game-container { background: white; border-radius: 20px; padding: 30px; max-width: 900px; margin: auto; }
        h1 { color: #4a5568; text-align: center; margin-bottom: 20px; }
        /* ... AJOUTE TOUT LE RESTE DE TON CSS ORIGINAL ... */
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Écran Lobby -->
        <div id="lobby">
            <h1>WORD BOX 2 JOUEURS</h1>
            <button onclick="createGame()" style="padding: 15px; margin: 10px; font-size: 18px;">
                Créer une partie
            </button>
            <br>
            <input id="gameCode" placeholder="Code de partie" style="padding: 10px; font-size: 16px;">
            <button onclick="joinGame()" style="padding: 15px; margin: 10px; font-size: 18px;">
                Rejoindre
            </button>
        </div>
        
        <!-- Écran Jeu -->
        <div id="gameScreen" style="display: none;">
            <h1>WORD BOX</h1>
            <div style="display: flex; justify-content: space-between; margin: 20px 0;">
                <div id="player1">Joueur 1: <span id="score1">0</span></div>
                <div id="timer">⏱️ <span id="time">02:00</span></div>
                <div id="player2">Joueur 2: <span id="score2">0</span></div>
            </div>
            
            <div id="currentWord" style="font-size: 24px; text-align: center; margin: 20px; min-height: 40px;">
                Glissez sur les lettres...
            </div>
            
            <!-- Grille 5x5 -->
            <div id="grid" style="
                display: grid;
                grid-template-columns: repeat(5, 60px);
                grid-gap: 10px;
                justify-content: center;
                margin: 20px;
            ">
                <!-- Les lettres seront ajoutées par JavaScript -->
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="submitWord()" style="padding: 15px 30px; font-size: 18px;">
                    Valider le mot
                </button>
            </div>
        </div>
    </div>

    <script>
let gameId = '';
let playerNumber = 1;
let grid = [];
let selected = [];
let isDragging = false;
let gameState = null;

// Drag & Drop
function startDrag(e) {
    e.preventDefault();
    isDragging = true;
    selected = [];
    updateSelection(e);
}

function dragOver(e) {
    if (!isDragging) return;
    e.preventDefault();
    updateSelection(e);
}

function endDrag() {
    if (!isDragging || selected.length < 3) return;
    isDragging = false;
    
    // Valider automatiquement
    const word = selected.map(idx => grid[idx]).join('');
    alert('Mot trouvé: ' + word);
    
    // Envoyer au serveur
    fetch('/api/game', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            action: 'submit', 
            gameId: gameId,
            word: word 
        })
    });
    
    // Réinitialiser
    selected = [];
    updateGrid();
}

function updateSelection(e) {
    const cell = e.target.closest('.letter-cell');
    if (!cell) return;
    
    const idx = parseInt(cell.dataset.index);
    if (!selected.includes(idx)) {
        selected.push(idx);
        updateGrid();
    }
}

function updateGrid() {
    const gridEl = document.getElementById('grid');
    gridEl.innerHTML = '';
    
    grid.forEach((letter, idx) => {
        const cell = document.createElement('div');
        cell.className = 'letter-cell';
        cell.dataset.index = idx;
        cell.textContent = letter;
        cell.style.background = selected.includes(idx) ? '#bee3f8' : 'white';
        
        cell.addEventListener('mousedown', startDrag);
        cell.addEventListener('touchstart', startDrag);
        
        gridEl.appendChild(cell);
    });
    
    // Afficher le mot en cours
    const currentWord = selected.map(idx => grid[idx]).join('');
    document.getElementById('currentWord').textContent = 
        currentWord || 'Glissez sur les lettres...';
}

// Timer synchronisé
function startGameSync() {
    setInterval(async () => {
        if (!gameId) return;
        
        const res = await fetch(`/api/game?gameId=${gameId}`);
        gameState = await res.json();
        
        // Mettre à jour l'interface
        document.getElementById('score1').textContent = gameState.scores[1];
        document.getElementById('score2').textContent = gameState.scores[2];
        document.getElementById('timer').textContent = 
            Math.floor(gameState.timeLeft / 60) + ':' + (gameState.timeLeft % 60);
        
        // Indiquer le tour
        document.getElementById('player1').style.opacity = gameState.turn === 1 ? '1' : '0.5';
        document.getElementById('player2').style.opacity = gameState.turn === 2 ? '1' : '0.5';
        
    }, 1000);
}

// Modifie createGame et joinGame pour utiliser la grille du serveur
async function createGame() {
    const res = await fetch('/api/game', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'create' })
    });
    const data = await res.json();
    
    if (data.success) {
        gameId = data.gameId;
        grid = data.grid;
        alert('Code: ' + gameId);
        joinGame();
    }
}

async function joinGame() {
    const code = document.getElementById('gameCode').value || gameId;
    const res = await fetch('/api/game', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'join', gameId: code })
    });
    const data = await res.json();
    
    if (data.success) {
        playerNumber = data.playerNumber;
        grid = data.grid;
        gameState = data.gameState;
        
        startGame();
        startGameSync();
        updateGrid();
    }
}

function startGame() {
    document.getElementById('lobby').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'block';
    
    // Activer le drag sur toute la grille
    document.getElementById('grid').addEventListener('mousemove', dragOver);
    document.getElementById('grid').addEventListener('touchmove', dragOver);
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('touchend', endDrag);
}
    </script>
</body>
</html>
